<spring:beans xmlns="http://membrane-soa.org/proxies/1/"
              xmlns:spring="http://www.springframework.org/schema/beans"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
					    http://membrane-soa.org/proxies/1/ http://membrane-soa.org/schemas/proxies-1.xsd">

    <router>
        <serviceProxy name="Resource Service" port="2001">

            <!-- Protects a resource with OAuth2 - blocks on invalid login -->
            <oauth2Resource publicURL="http://localhost:2001/">
                <membrane src="http://localhost:2000" clientId="abc" clientSecret="def" scope="openid profile" claims="username" claimsIdt="sub" />
            </oauth2Resource>

            <!-- This is optional. You can use the information from the authentication server and pass it to the resource server or do
             anything you want. -->
            <groovy>
                def oauth2 = exc.properties.oauth2
                <!-- Put the eMail of the user into the request header X-EMAIL and pass it to the protected server. -->
                exc.request.header.setValue('X-EMAIL',oauth2.userinfo.email)
                CONTINUE
            </groovy>

            <!-- Route to the protected resource on valid access token -->
            <target host="localhost" port="2002"/>

        </serviceProxy>

        <!-- Protected resource -->
        <serviceProxy port="2002">
            <groovy>
                exc.setResponse(Response.ok("Hello " + exc.request.header.getFirstValue("X-EMAIL")).build())
                RETURN
            </groovy>
        </serviceProxy>

        <serviceProxy port="9001">
            <adminConsole/>
        </serviceProxy>

    </router>

</spring:beans>